{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!--<link rel="stylesheet" href="{% static 'css/black-dashboard.min.css' %}">-->
    <script src="{% static 'js/black-dashboard.min.js' %}"></script>
    <script src="https://cdn.flexmonster.com/flexmonster.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link rel="stylesheet" href="https://cdn.flexmonster.com/demo.css">
    <title>Flight Report</title>
</head>

<body>
    <div class = col-lg-12 id="data-table-container" data-url="{% url 'flight_data' %}"></div>

    <script>
        function processData(dataset) {
            var result = []
            dataset = JSON.parse(dataset);
            dataset.forEach(item => result.push(item.fields));
            return result;
        }

        $.ajax({
            url: $("#data-table-container").attr("data-url"),
            dataType: 'json',
            success: function(data){
                new Flexmonster({
                    container: "#data-table-container",
                    componentFolder: "https://cdn.flexmonster.com/",
                    width: "100%",
                    height: 430,
                    toolbar: true,
                    report: {
                        dataSource: {
                            type: "json",
                            data: processData(data),
                            mapping: {
                                "fk_flightstatus": {
                                    "caption": "Flight Status"
                                },
                                "tx_code": {
                                    "caption": "Flight Code"
                                },
                                "dt_est_departure": {
                                    "caption": "Departure Date",
                                    "type": "date"
                                },
                                "dt_est_arrival": {
                                    "caption": "Arrival Date",
                                    "type": "date"
                                },
                                "nm_origin": {
                                    "caption": "Origin"
                                },
                                "nm_destination": {
                                    "caption": "Destination"
                                },
                            }
                        },
                        "slice": {
                            "columns": [{
                                "uniqueName": "tx_code"
                                },
                                {
                                    "uniqueName": "fk_flightstatus"
                                },
                                {
                                    "uniqueName": "dt_est_departure"
                                },
                                {
                                    "uniqueName": "dt_est_arrival"
                                },
                                {
                                    "uniqueName": "nm_origin"
                                },
                                {
                                    "uniqueName": "nm_destination"
                                },

                            ]
                        }
                    }
                });
            }
        })
    </script>

</body>